<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>priocpp: prio</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">priocpp
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">prio </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>promising reactive io</p>
<h1>dependencies</h1>
<p>repro header library for promises openssl for ssl support</p>
<h1>backend dependencies</h1>
<p>using libevent (default) or (experimentai) boost_asio as main event loop backend</p>
<h1>features</h1>
<p>this library implements basics to use reactive repro promise from an event loop.</p>
<p>implemented basics are</p><ul>
<li>timeouts</li>
<li>async socket io</li>
<li>POSIX signal handling</li>
<li>get multithreaded by threading out with tasks</li>
</ul>
<h1>api</h1>
<h2>timeouts</h2>
<p>timeout api declarations with futures:</p>
<div class="fragment"><div class="line">Future&lt;&gt; <a class="code" href="timeout_8h.html#af3e729d171f46dad81e5e3e271855bb5">timeout</a>(<span class="keywordtype">int</span> secs, <span class="keywordtype">int</span> ms) noexcept;</div><div class="line">Future&lt;&gt; <a class="code" href="timeout_8h.html#af3e729d171f46dad81e5e3e271855bb5">timeout</a>(<span class="keywordtype">int</span> secs) noexcept;</div><div class="line"></div><div class="line"><span class="comment">//usage example using a timeout in 10 seconds</span></div><div class="line"><a class="code" href="timeout_8h.html#af3e729d171f46dad81e5e3e271855bb5">timeout</a>(10)</div><div class="line">.<a class="codeRef" doxygen="/home/mike/workspace/repro/repro.tag:../../repro/docs/" href="../../repro/docs/classrepro_1_1FutureMixin.html#a33606d2e56d8d79609c2cdf4bbc8db98">then</a>([]()</div><div class="line">{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;timeout!&quot;</span> &lt;&lt; std::endl;</div><div class="line">});</div></div><!-- fragment --><p><em>nextTick</em> helper to run a timeout as soon as possible:</p>
<div class="fragment"><div class="line">Future&lt;&gt; <a class="code" href="api_8h.html#adda63700d6e78cfc221e3f0a8429489e">nextTick</a>() noexcept;</div><div class="line"></div><div class="line"><span class="comment">//usage example </span></div><div class="line">nextTick()</div><div class="line">.then([]()</div><div class="line">{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;now next on the event loop!&quot;</span> &lt;&lt; std::endl;</div><div class="line">});</div></div><!-- fragment --><p>threadsafe version that can be called safely from within a prio::task</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="timeout_8h.html#af3e729d171f46dad81e5e3e271855bb5">timeout</a>( <span class="keyword">const</span> std::function&lt;<span class="keywordtype">void</span>()&gt;&amp; f, <span class="keywordtype">int</span> secs, <span class="keywordtype">int</span> ms) noexcept;</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="timeout_8h.html#af3e729d171f46dad81e5e3e271855bb5">timeout</a>( <span class="keyword">const</span>  std::function&lt;<span class="keywordtype">void</span>()&gt;&amp; f, <span class="keywordtype">int</span> secs) noexcept;</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="api_8h.html#adda63700d6e78cfc221e3f0a8429489e">nextTick</a>( <span class="keyword">const</span>  std::function&lt;<span class="keywordtype">void</span>()&gt;&amp; f) noexcept;</div><div class="line"></div><div class="line"><span class="comment">//usage example </span></div><div class="line"><a class="code" href="api_8h.html#adda63700d6e78cfc221e3f0a8429489e">nextTick</a>( []()</div><div class="line">{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;now next on the event loop!&quot;</span> &lt;&lt; std::endl;</div><div class="line">});</div></div><!-- fragment --><h2>async socket io</h2>
<h3>connect using a client socket</h3>
<div class="fragment"><div class="line"><span class="comment">// someone is supposed to manage connection lifetime!</span></div><div class="line">Connection::Ptr ptr; </div><div class="line">TcpConnection::connect(<span class="stringliteral">&quot;localhost&quot;</span>, 9876)</div><div class="line">.then([&amp;ptr](Connection::Ptr client)</div><div class="line">{</div><div class="line">    ptr = client;</div><div class="line">    <span class="keywordflow">return</span> client-&gt;write(<span class="stringliteral">&quot;HELO WORLD&quot;</span>);</div><div class="line">})</div><div class="line">.then([](Connection::Ptr client)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> client-&gt;read();</div><div class="line">})</div><div class="line">.then([&amp;result,&amp;listener](Connection::Ptr client, std::string data)</div><div class="line">{</div><div class="line">    result = data;</div><div class="line">    <a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afb0ca68ebaa020f72cff44a5945d8e29">exit</a>();</div><div class="line">});</div><div class="line"></div><div class="line"><a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afd47242349ee230715b7c8714ac77b52">run</a>();</div></div><!-- fragment --><h3>server side listening to a socket</h3>
<div class="fragment"><div class="line"><span class="comment">// someone is supposed to manage connection lifetime</span></div><div class="line"><span class="comment">// here we support only client, echoing the request payload</span></div><div class="line">Connection::Ptr c;</div><div class="line"></div><div class="line">Listener listener;</div><div class="line">listener.bind(9876)</div><div class="line">.then([&amp;c](Connection::Ptr client)</div><div class="line">{</div><div class="line">    c = client;</div><div class="line">    client-&gt;read()</div><div class="line">    .then( [](Connection::Ptr client,std::string data)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> client-&gt;write(data);</div><div class="line">    })</div><div class="line">    .then([](Connection::Ptr client)</div><div class="line">    {</div><div class="line">        <a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afb0ca68ebaa020f72cff44a5945d8e29">exit</a>();</div><div class="line">    });</div><div class="line">});</div><div class="line"><a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afd47242349ee230715b7c8714ac77b52">run</a>();</div></div><!-- fragment --><h1>signal handling</h1>
<div class="fragment"><div class="line"><a class="code" href="signal_8h.html#ae479923d98f41b9e0ae9defa939aad5c">signal</a>(SIGINT)</div><div class="line">.then([](<span class="keywordtype">int</span> s)</div><div class="line">{</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;SIGINT (&quot;</span> &lt;&lt; s &lt;&lt;<span class="stringliteral">&quot;) called&quot;</span> &lt;&lt; std::endl;</div><div class="line">});</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">theLoop().run();</div></div><!-- fragment --><h1>treadsafe tasking</h1>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> c = 0;</div><div class="line"></div><div class="line"><a class="code" href="task_8h.html#ab011f36aed0b849e6c3ba021273ec5b3">task</a>([c]()</div><div class="line">{</div><div class="line">    <span class="comment">// run and compute on separate thread</span></div><div class="line">    <span class="keywordflow">return</span> c++;</div><div class="line">})</div><div class="line">.then([&amp;c](<span class="keywordtype">int</span> i)</div><div class="line">{</div><div class="line">    c = i;</div><div class="line">    <a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afb0ca68ebaa020f72cff44a5945d8e29">exit</a>();</div><div class="line">});</div><div class="line"></div><div class="line"><a class="code" href="loop_8h.html#a9ea1c0beeac8a2c8ce19401d5b6c616f">theLoop</a>().<a class="code" href="classprio_1_1Loop.html#afd47242349ee230715b7c8714ac77b52">run</a>();</div><div class="line"></div><div class="line"><span class="comment">// prints 1</span></div><div class="line">std::cout &lt;&lt; c &lt;&lt; std::endl;</div></div><!-- fragment --><h1>install</h1>
<p>see <a href="https://github.com/littlemole/repro-web/">repro-web</a> for installing complete library chain and examples.</p>
<h1>install for local development</h1>
<p>## native linux </p><div class="fragment"><div class="line">git clone https://github.com/littlemole/prio.git</div><div class="line">make </div><div class="line">make test</div><div class="line">make install</div></div><!-- fragment --><p> self documention makefile, run <em>make help</em> for details</p>
<h2>cmake support</h2>
<p>building with cmake is supported assuming build happens in a dedicated build directory different from the root src directory.</p>
<h3>default build CXX=g++ and BACKEND=libevent</h3>
<div class="fragment"><div class="line">git clone https://github.com/littlemole/prio.git</div><div class="line">cd prio</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake ..</div><div class="line">make</div><div class="line">ctest</div><div class="line">sudo make install    </div></div><!-- fragment --><h3>build with different BACKEND=boost_asio</h3>
<div class="fragment"><div class="line">git clone https://github.com/littlemole/prio.git</div><div class="line">cd prio</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DWITH_LIBEVENT=Off</div><div class="line">make</div><div class="line">ctest</div><div class="line">sudo make install    </div></div><!-- fragment --> <h3>build for CXX=clang++ and default BACKEND</h3>
<div class="fragment"><div class="line">git clone https://github.com/littlemole/prio.git</div><div class="line">cd prio</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DCMAKE_CXX_COMPILER=&quot;clang++&quot; -DCMAKE_CXX_FLAGS=&quot;-std=c++14 -stdlib=libc++&quot;</div><div class="line">make</div><div class="line">ctest</div><div class="line">sudo make install    </div></div><!-- fragment --><p> note this requires not only clang++ toolchain installed, but also dependent cpp libraries built against clang++ and libc++. for this project that means gtest and cryptoneat libraries have to be built using clang++ toolchain.</p>
<h3>build for CXX=clang++ and BACKEND=boost_asio</h3>
<p>just add both options from above to calling cmake.</p>
<h2>docker</h2>
<p>the makefile has targets to build and test this lib in an reproducible environment. see Dockerfile for concrete setup. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
